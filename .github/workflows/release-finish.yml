name: Git Flow Release Finish

on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version (e.g. v1.2.3)'
        required: true

permissions:
  contents: write

jobs:
  finish-release:
    runs-on: self-hosted

    steps:
      - name: gitflow-workflow-action release workflows
        uses: hoangvvo/gitflow-workflow-action@v1.0.0
        with:
          develop_branch: "develop"
          main_branch: "main"
          merge_back_from_main: false
          version: ${{ inputs.release_version }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Post to a Slack channel
        if: success()
        uses: slackapi/slack-github-action@v2.0.0
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            channel: ${{ secrets.SLACK_CHANNEL_ID }}
            text: >
              ðŸŽ‰ [ë¦´ë¦¬ìŠ¤ ì™„ë£Œ ì•Œë¦¼]
              
              *ë²„ì „:* `${{ inputs.release_version }}`
              
              ðŸ”— <https://github.com/${{ github.repository }}/releases|GitHub ë¦´ë¦¬ìŠ¤ íŽ˜ì´ì§€>
              ðŸ“¦ <https://github.com/${{ github.repository }}/releases/tag/${{ inputs.release_version }}|ì´ë²ˆ ë¦´ë¦¬ìŠ¤ ë³´ê¸°>  
      